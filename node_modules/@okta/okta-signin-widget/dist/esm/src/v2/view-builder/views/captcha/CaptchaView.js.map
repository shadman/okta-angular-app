{"version":3,"file":"CaptchaView.js","sources":["../../../../../../../src/v2/view-builder/views/captcha/CaptchaView.js"],"sourcesContent":["/*!\n * Copyright (c) 2021, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { View } from '@okta/courage';\nimport Enums from 'util/Enums';\nimport Util from 'util/Util';\nimport hbs from '@okta/handlebars-inline-precompile';\nimport { WIDGET_FOOTER_CLASS } from '../../utils/Constants';\n\nconst OktaSignInWidgetOnCaptchaLoadedCallback = 'OktaSignInWidgetOnCaptchaLoaded';\nconst OktaSignInWidgetOnCaptchaSolvedCallback = 'OktaSignInWidgetOnCaptchaSolved';\n\nconst HCAPTCHA_URL = 'https://hcaptcha.com/1/api.js';\nconst ALTCHA_URL = 'https://cdn.jsdelivr.net/gh/altcha-org/altcha/dist/altcha.min.js';\nconst RECAPTCHAV2_URL = 'https://www.google.com/recaptcha/api.js';\n\nexport default View.extend({\n  className: 'captcha-view',\n\n  template: hbs`\n    {{#if isCaptchaConfigured}}\\\n      <div id =\"captcha-container\"\n          class=\"{{className}}\"\n          data-sitekey=\"{{siteKey}}\"\n          data-callback=\"{{onCaptchaSolvedCallback}}\"\n          data-size=\"invisible\">\n      </div>\n    {{/if}}\\\n  `,\n\n  getTemplateData: function() {\n    if (this.captchaConfig) {\n      let className;\n\n      if (this.captchaConfig.type === 'ALTCHA') {\n        className = 'altcha-captcha';\n      } else if (this.captchaConfig.type === 'HCAPTCHA') {\n        className = 'h-captcha';\n      } else {\n        className = 'g-recaptcha';\n      }\n\n      return { \n        siteKey: this.captchaConfig.siteKey,\n        isCaptchaConfigured: true,\n        onCaptchaSolvedCallback: OktaSignInWidgetOnCaptchaSolvedCallback,\n        className, \n      };\n    } else {\n      return {};\n    }\n  },\n\n  initialize() {\n    if (this.options.appState.get('captcha')) {\n      this.captchaConfig = this.options.appState.get('captcha');\n      this._addCaptcha();\n    }\n  },\n\n  remove: function(){\n    View.prototype.remove.apply(this, arguments);\n\n    // Cleanup global Captcha references\n    if (this.captchaConfig.type === 'HCAPTCHA') {\n      window.hcaptcha = undefined;\n    } else if (this.captchaConfig.type === 'RECAPTCHA_V2') {\n      window.grecaptcha = undefined;\n    }\n  },\n\n  /**\n   *  Load the CAPTCHA lib dynamically (either HCAPTCHA or RECAPTCHAV2). Once loaded, trigger an event to inform\n   *  the parent form to actually render the CAPTCHA.\n  * */   \n  _addCaptcha() {\n    // Callback invoked when CAPTCHA is solved.\n    const onCaptchaSolved = (token) => {\n      const captchaObject = this._getCaptchaOject();\n\n      // We reset the Captcha. We need to reset because every time the \n      // Captcha resolves back with a token and say we have a server side error, \n      // if we submit the form again it won't work otherwise. The Captcha \n      // has to be reset for it to work again in that scenario.\n      const captchaId = this.$el.find('#captcha-container').attr('data-captcha-id');\n      captchaObject.reset(captchaId);\n\n      // Set the token in the model\n      const fieldName = this.options.name;\n      this.model.set(fieldName, token);\n\n      this.options.appState.trigger('saveForm', this.model); \n    };\n\n    const setUpTempToken = () => {\n      // This is just a safeguard to ensure we don't bind Captcha to an already bound element.\n      // It shouldn't happen in practice.\n      if (this.$el.find('#captcha-container').attr('data-captcha-id')) {\n        return;\n      }\n\n      // We set a temporary token for Captcha because this is a required field for the form and is normally set\n      // at a later time. In order to prevent client-side validation errors because of this, we have to set a \n      // dummy value. We then overwrite this with the proper token in the onCaptchaSolved callback.\n      this.model.set(this.options.name, 'tempToken');\n    };\n\n    const onAltchaCaptchaLoaded = () => {\n      setUpTempToken();\n\n      const $container = this.$el.find('#captcha-container');\n      const altEl = document.createElement('altcha-widget');\n\n      Object.entries({\n        floating: true,\n        hidefooter: true,\n        hidelogo: true,\n        challengeurl: '/api/v1/altcha',\n      }).forEach(([key, value]) => altEl.setAttribute(key, value));\n\n      if (altEl.addEventListener) {\n        altEl.addEventListener('verified', (e) => {\n          const token = (e && e.detail && e.detail.payload) || e;\n          onCaptchaSolved(token);\n          $container.empty();\n        });\n      }\n\n      window.altcha = altEl;\n      $container.empty().append(altEl);\n      // mark as bound\n      $container.attr('data-captcha-id', 'altcha');\n      // notify Baseform\n      this.options.appState.trigger('onCaptchaLoaded', altEl);\n    };\n\n    // Callback when CAPTCHA lib is loaded\n    const onReCaptchaOrHCaptchaLoaded = () => {\n      setUpTempToken();\n\n      const captchaObject = this._getCaptchaOject();\n\n      const captchaId = captchaObject.render('captcha-container', {\n        sitekey: this.captchaConfig.siteKey,\n        callback: onCaptchaSolved\n      });\n      \n      this.$el.find('#captcha-container').attr('data-captcha-id', captchaId);\n\n      // Let the Baseform know that Captcha is loaded.\n      this.options.appState.trigger('onCaptchaLoaded', captchaObject);\n\n      // Render the HCAPTCHA footer - we need to do this manually since the HCAPTCHA lib doesn't do it\n      if (this.captchaConfig.type === 'HCAPTCHA') {\n        this._addHCaptchaFooter();\n      }  \n    };\n\n    // Attaching the callback to the window object so that the CAPTCHA script that we dynamically render\n    // can have access to it since it won't have access to this view's scope.\n    if(this.captchaConfig.type === 'ALTCHA') {\n      window[OktaSignInWidgetOnCaptchaLoadedCallback] = onAltchaCaptchaLoaded;\n    } else {\n      window[OktaSignInWidgetOnCaptchaLoadedCallback] = onReCaptchaOrHCaptchaLoaded;\n    }\n\n    // Attaching the Captcha solved callback to the window object because we reference it in our template under\n    // the 'data-callback' attribute which the Captcha library uses to invoke the callback.\n    window[OktaSignInWidgetOnCaptchaSolvedCallback] = onCaptchaSolved;\n\n\n    if (this.captchaConfig.type === 'HCAPTCHA') {\n      this._loadCaptchaLib(this._getCaptchaUrl(HCAPTCHA_URL, 'hcaptcha'));\n    } else if (this.captchaConfig.type === 'RECAPTCHA_V2') {\n      this._loadCaptchaLib(this._getCaptchaUrl(RECAPTCHAV2_URL, 'recaptcha'));\n    } if (this.captchaConfig.type === 'ALTCHA') {\n      this._loadCaptchaLib(this._getCaptchaUrl(ALTCHA_URL, 'altcha'));\n    }\n  },\n  \n  /**\n   *  We dynamically inject <script> tag into our login container because in case the customer is hosting\n   *  the SIW, we need to ensure we don't go out of scope when injecting the script.\n  * */ \n  _loadCaptchaLib(url) {\n    let scriptTag = document.createElement('script');\n    scriptTag.src = url;\n    scriptTag.async = true;\n    scriptTag.defer = true;\n\n    if (url.indexOf('altcha') !== -1) {\n      scriptTag.type = 'module';\n      scriptTag.onload = window[OktaSignInWidgetOnCaptchaLoadedCallback];\n    }\n\n    document.getElementById(Enums.WIDGET_CONTAINER_ID).appendChild(scriptTag);\n  },\n\n  _addHCaptchaFooter() {\n    // NOTE: insetAdjacentHTML() is supported in all major browsers: \n    // https://developer.mozilla.org/en-US/docs/Web/API/Element/insertAdjacentHTML#browser_compatibility\n    const footerContainer = document.getElementsByClassName(WIDGET_FOOTER_CLASS);\n    if (footerContainer.length) {\n      const template = hbs('<div class=\"captcha-footer\">\\\n        <span class=\"footer-text\">\\\n          {{i18n code=\"hcaptcha.footer.label\" bundle=\"login\" \\\n          $1=\"<a href=\\'https://hcaptcha.com/privacy\\' target=\\'_blank\\'>$1</a>\" \\\n          $2=\"<a href=\\'https://hcaptcha.com/terms\\' target=\\'_blank\\'>$2</a>\"}}\\\n        </span>\\\n      </div>');\n\n      footerContainer[0].insertAdjacentHTML('beforeend',\n        template()\n      );\n    }\n  },\n\n  _getCaptchaOject() {\n    // Return the appropriate global captcha object for the configured type.\n    if (this.captchaConfig.type === 'HCAPTCHA') {\n      return window.hcaptcha;\n    }\n    if (this.captchaConfig.type === 'RECAPTCHA_V2') {\n      return window.grecaptcha;\n    }\n    if (this.captchaConfig.type === 'ALTCHA') {\n      // Altcha may expose different globals or be used as a web component.\n      return window.altcha ?? null;\n    }\n    return null;\n  },\n\n  /**\n   *  Supported params for hCaptcha script:\n   *   https://github.com/hCaptcha/hcaptcha-loader#props\n   *   (starting from 'apihost')\n   *  Supported params for reCAPTCHA script:\n   *   https://developers.google.com/recaptcha/docs/display#javascript_resource_apijs_parameters\n  * */\n  _getCaptchaUrl(defaultBaseUrl, settingsKey) {\n    const locale = this.options.settings.get('language');\n    const scriptSource = this.options.settings.get(`${settingsKey}.scriptSource`);\n    const scriptParams = this.options.settings.get(`${settingsKey}.scriptParams`);\n\n    const baseUrl = scriptSource || defaultBaseUrl;\n\n    // Altcha is a web component / module; don't append reCAPTCHA/hCaptcha-specific query params.\n    if (settingsKey === 'altcha') {\n      return baseUrl;\n    }\n\n    const params = {\n      ...scriptParams,\n      onload: OktaSignInWidgetOnCaptchaLoadedCallback,\n      render: 'explicit',\n      hl: locale || navigator.language,\n    };\n    const query = Util.searchParamsToString(params);\n    return baseUrl + '?' + query;\n  },\n\n});\n"],"names":["OktaSignInWidgetOnCaptchaLoadedCallback","OktaSignInWidgetOnCaptchaSolvedCallback","HCAPTCHA_URL","ALTCHA_URL","RECAPTCHAV2_URL","View","extend","className","template","getTemplateData","captchaConfig","type","siteKey","isCaptchaConfigured","onCaptchaSolvedCallback","initialize","options","appState","get","_addCaptcha","remove","prototype","apply","arguments","window","hcaptcha","undefined","grecaptcha","onCaptchaSolved","token","captchaObject","_getCaptchaOject","captchaId","$el","find","attr","reset","fieldName","name","model","set","trigger","setUpTempToken","onAltchaCaptchaLoaded","$container","altEl","document","createElement","Object","entries","floating","hidefooter","hidelogo","challengeurl","forEach","key","value","setAttribute","addEventListener","e","detail","payload","empty","altcha","append","onReCaptchaOrHCaptchaLoaded","render","sitekey","callback","_addHCaptchaFooter","_loadCaptchaLib","_getCaptchaUrl","url","scriptTag","src","async","defer","indexOf","onload","getElementById","Enums","WIDGET_CONTAINER_ID","appendChild","footerContainer","getElementsByClassName","WIDGET_FOOTER_CLASS","length","insertAdjacentHTML","defaultBaseUrl","settingsKey","locale","settings","scriptSource","scriptParams","baseUrl","params","hl","navigator","language","query","Util","searchParamsToString"],"mappings":"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"}