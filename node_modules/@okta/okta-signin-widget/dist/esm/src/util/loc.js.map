{"version":3,"file":"loc.js","sources":["../../../../src/util/loc.ts"],"sourcesContent":["/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n// Source code was copied from @okta/courage\n//  (src/courage/util/StringUtil.js)\n//  and should be kept in sync with @okta/courage\n\nimport Bundles from '@okta/okta-i18n-bundles';\n\nconst bundleNames = ['login', 'country', 'courage'];\ntype BundleName = typeof bundleNames[number];\ntype Bundle = {\n  [key: string]: string\n};\ntype Bundles = {\n  [key in BundleName]: Bundle;\n};\n\ninterface L10nErrorDetail {\n  type: 'l10n-error';\n  key: string;\n  bundleName: string;\n  reason: string;\n}\n\ndeclare global {\n  interface Window {\n    okta?: {\n      locale?: string\n    }\n  }\n}\n\n/**\n * Checks whether a translation for key exists in the bundle\n * @param  {String} key The key\n * @param  {String} [bundle=\"login\"] The name of the i18n bundle. Defaults to \"login\".\n * @return {Boolean}\n */\nexport const doesTranslationExist = (\n  key: string,\n  bundleName: BundleName = 'login'\n) => {\n  const bundle = getBundle(bundleName);\n  return !!bundle?.[key];\n};\n\n/**\n * Translate a key to the localized value\n * @param  {String} key The key\n * @param  {String} [bundle=\"login\"] The name of the i18n bundle. Defaults to \"login\".\n * @param  {Array} [params] A list of parameters to apply as tokens to the i18n value\n * @param  {Boolean} [ignoreIncorrectParams] If true, a custom 'okta-i18n-error' event would not be dispatched\n * @return {String} The localized value\n */\nexport const loc = function (\n  key: string,\n  bundleName: BundleName = 'login',\n  params: Array<string | number | boolean | unknown> = [],\n  ignoreIncorrectParams = false\n) {\n  const bundle = getBundle(bundleName);\n  /* eslint complexity: [2, 7] */\n\n  if (!bundle) {\n    emitL10nError(key, bundleName, 'bundle');\n    return 'L10N_ERROR[' + bundleName + ']';\n  }\n\n  let value = bundle[key];\n\n  try {\n    params = params && params.slice ? params.slice(0) : [];\n    value = sprintf(value, params);\n\n    if (value) {\n      return value;\n    } else {\n      emitL10nError(key, bundleName, 'key');\n      return 'L10N_ERROR[' + key + ']';\n    }\n  } catch (e) {\n    if (!ignoreIncorrectParams) {\n      emitL10nError(key, bundleName, 'parameters');\n    }\n    return 'L10N_ERROR[' + key + ']';\n  }\n};\n\n/**\n* Converts the locale code identifier from \"${languageCode}-${countryCode}\" to \"${languageCode}_${countryCode}\"\n* Follows the ISO-639-1 language code and 2-letter ISO-3166-1-alpha-2 country code structure.\n* @param {String} locale code identifier\n* @return {String} converted locale code identifier\n*/\nconst parseLocale = (locale: string) => {\n  if (/-/.test(locale)) {\n    const parts = locale.split('-');\n    parts[1] = parts[1].toUpperCase();\n    return parts.join('_');\n  }\n\n  return locale;\n};\n\n/**\n * Returns the language bundle based on the current locale.\n * - If a locale is not provided, default to English ('en')\n * - Legacy Support: If the named language bundle does not exist, fall back to the default named bundle.\n *\n * @param {*} bundleName\n */\nfunction getBundle(bundleName: BundleName): Bundle {\n  if (!bundleName) {\n    const key = Object.keys(Bundles).filter(k => typeof k === 'object')[0];\n    return Bundles[key];\n  }\n\n  const locale = parseLocale(getRawLocale());\n  return Bundles[`${bundleName}_${locale}`] || Bundles[bundleName];\n}\n\n/**\n * Returns the user's locale as defined by window.okta.locale\n */\nfunction getRawLocale() {\n  return window?.okta?.locale || 'en';\n}\n\n/**\n * Dispatch custom 'okta-i18n-error' event\n * @param {String} key The i18n key\n * @param {String} bundleName The i18n bundle name\n * @param {String} reason Could be 'bundle' (Bundle not found), 'key' (Key not found) or 'parameters' (Parameters mismatch).\n */\nfunction emitL10nError(key: string, bundleName: string, reason: string) {\n  const event = createCustomEvent('okta-i18n-error', {\n    detail: {\n      type: 'l10n-error',\n      key: key,\n      bundleName: bundleName,\n      reason: reason\n    }\n  });\n  if (event) {\n    document.dispatchEvent(event);\n  }\n}\n\nconst createCustomEvent = function (event: string, params: CustomEventInit<L10nErrorDetail>) {\n  if (typeof window.CustomEvent === 'function') {\n    return new CustomEvent(event, params);\n  } else if (!window.CustomEvent) {\n    /**\n     * CustomEvent polyfill for IE\n     * https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent#polyfill\n     */\n    params = params || {\n      bubbles: false,\n      cancelable: false,\n      detail: null\n    };\n    const evt = document.createEvent('CustomEvent');\n    evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n    return evt;\n  }\n};\n\n/**\n * Format tempalte string with parameters\n * @param {String} value Template string, eg. \"Reset via {0}\"\n * @param  {Array} [params] A list of parameters to apply as tokens to the template string, eg. [\"SMS\"]\n * @return {String} Formatted string value, eg. \"Reset via SMS\"\n */\nfunction sprintf(value: string, params: Array<string | number | boolean | unknown>) {\n  /* eslint max-statements: [2, 15] */\n\n  function triggerError() {\n    throw new Error('Mismatch number of variables: ' + value + ', ' + JSON.stringify(params));\n  }\n\n  let oldValue = value, newValue = value;\n  for (let i = 0, l = params.length; i < l; i++) {\n    const entity = String(params[i]);\n    const regex = new RegExp('\\\\{' + i + '\\\\}', 'g');\n    newValue = newValue.replace(regex, entity);\n\n    if (entity === undefined || entity === null || newValue === oldValue) {\n      triggerError();\n    }\n\n    oldValue = newValue;\n  }\n\n  if (/\\{[\\d+]\\}/.test(newValue)) {\n    triggerError();\n  }\n\n  return newValue;\n}\n"],"names":["doesTranslationExist","key","bundleName","bundle","getBundle","loc","params","ignoreIncorrectParams","emitL10nError","value","slice","sprintf","e","parseLocale","locale","test","parts","split","toUpperCase","join","Object","keys","Bundles","filter","k","getRawLocale","window","okta","reason","event","createCustomEvent","detail","type","document","dispatchEvent","CustomEvent","bubbles","cancelable","evt","createEvent","initCustomEvent","triggerError","Error","JSON","stringify","oldValue","newValue","i","l","length","entity","String","regex","RegExp","replace","undefined"],"mappings":"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"}