{"version":3,"file":"Util.js","sources":["../../../../src/util/Util.js"],"sourcesContent":["/* eslint-disable max-statements */\n/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n/* eslint complexity: [2, 13], max-depth: [2, 3] */\nimport _ from 'underscore';\nimport { loc, doesTranslationExist } from './loc';\nimport Enums from './Enums';\nimport Logger from './Logger';\nimport BrowserFeatures from './BrowserFeatures';\n\nconst Util = {};\n\nconst buildInputForParameter = function(name, value) {\n  const input = document.createElement('input');\n\n  input.name = name;\n  input.value = decodeURIComponent(value);\n  input.type = 'hidden';\n  return input;\n};\n\nconst buildSubmitInput = function() {\n  const input = document.createElement('input');\n  input.type = 'submit';\n  return input;\n};\n\nconst buildDynamicForm = function(url = '', method) {\n  const splitOnFragment = url.split('#');\n  const fragment = splitOnFragment[1];\n  const splitOnQuery = (splitOnFragment[0] || '').split('?');\n  const query = splitOnQuery[1];\n  let targetUrl = splitOnQuery[0];\n\n  if (fragment) {\n    targetUrl += '#' + fragment;\n  }\n\n  const form = document.createElement('form');\n\n  form.method = method;\n  form.style.display = 'none';\n  form.action = targetUrl;\n  if (query && query.length) {\n    const queryParts = query.split('&');\n\n    queryParts.forEach(queryPart => {\n      const parameterParts = queryPart.split('=');\n      const input = buildInputForParameter(parameterParts[0], parameterParts[1]);\n\n      form.appendChild(input);\n    });\n  }\n  form.appendChild(buildSubmitInput());\n\n  return form;\n};\n\n// eslint-disable-next-line complexity\nUtil.transformErrorXHR = function(xhr) {\n  // Handle network connection error\n  if (xhr.status === 0 && _.isEmpty(xhr.responseJSON)) {\n    xhr.responseJSON = { errorSummary: loc('error.network.connection', 'login') };\n    return xhr;\n  }\n  if (!xhr.responseJSON) {\n    if (!xhr.responseText) {\n      // Empty server response\n      xhr.responseJSON = { errorSummary: loc('error.unsupported.response', 'login') };\n      return xhr;\n    }\n    if (typeof xhr.responseText === 'string') {\n      try {\n        xhr.responseJSON = JSON.parse(xhr.responseText);\n      } catch (e) {\n        // Malformed server response\n        xhr.responseJSON = { errorSummary: loc('error.unsupported.response', 'login') };\n        return xhr;\n      }\n    } else if (typeof xhr.responseText === 'object') {\n      xhr.responseJSON = xhr.responseText;\n    }\n  }\n  // Temporary solution to display field errors\n  // Assuming there is only one field error in a response\n  if (xhr.responseJSON && xhr.responseJSON.errorCauses && xhr.responseJSON.errorCauses.length) {\n    xhr.responseJSON.errorSummary = xhr.responseJSON.errorCauses[0].errorSummary;\n  }\n  // Replace error messages\n  if (!_.isEmpty(xhr.responseJSON)) {\n    const { errorCode } = xhr.responseJSON;\n    const errorMsg = errorCode && doesTranslationExist('errors.' + errorCode, 'login')\n      // We don't pass parameters to the `loc()` util\n      // However some i18n keys like `errors.E0000001` require one parameter\n      // Don't dispatch custom 'okta-i18n-error' event in this case\n      ? loc('errors.' + errorCode, 'login', [], true)\n      : undefined;\n\n    if (errorMsg?.indexOf('L10N_ERROR[') === -1) {\n      xhr.responseJSON.errorSummary = errorMsg;\n      if (xhr.responseJSON && xhr.responseJSON.errorCauses && xhr.responseJSON.errorCauses.length) {\n        // BaseForm will consume errorCauses before errorSummary if it is an array,\n        // so, we have to make sure to remove it when we have a valid error code\n        delete xhr.responseJSON.errorCauses;\n      }\n    }\n  }\n  return xhr;\n};\n\n// Simple helper function to lowercase all strings in the given array\nUtil.toLower = function(strings) {\n  return _.map(strings, function(str) {\n    return str.toLowerCase();\n  });\n};\n\n// A languageCode can be composed of multiple parts, i.e:\n// {{language}}-{{region}}-{{dialect}}\n//\n// In these cases, it's necessary to generate a list of other possible\n// combinations that we might support (in preferred order).\n//\n// For example:\n// en-US -> [en-US, en]\n// de-DE-bavarian -> [de-DE-bavarian, de-DE, de]\nfunction expandLanguage(language) {\n  const expanded = [language];\n  const parts = language.split('-');\n\n  while (parts.pop() && parts.length > 0) {\n    expanded.push(parts.join('-'));\n  }\n  return expanded;\n}\n\n// Following the rules of expanding one language, this will generate\n// all potential languages in the given order (where higher priority is\n// given to expanded languages over other downstream languages).\nUtil.expandLanguages = function(languages) {\n  return _.chain(languages).map(expandLanguage).flatten().uniq().value();\n};\n\n//helper to call setTimeout\nUtil.callAfterTimeout = function(callback, time) {\n  return setTimeout(callback, time);\n};\n\n// Invokes the callback after a delay, if the window remains in focus\n// If the window becomes unfocused, the callback execution is delayed until\n// focus has been returned to the window\nUtil.callAfterTimeoutOrWindowRefocus = function(callback, time, delayAfterRefocus = false) {\n  let timeoutId;\n  let visHandler;\n\n  const invokeCallbackFn = () => {\n    document.removeEventListener('visibilitychange', visHandler);\n    if (!delayAfterRefocus) {\n      return callback();\n    }\n\n    setTimeout(callback, time);\n  };\n\n  visHandler = () => {\n    if (document.hidden) {\n      clearTimeout(timeoutId);\n    }\n    else {\n      invokeCallbackFn();\n    }\n  };\n\n  document.addEventListener('visibilitychange', visHandler);\n  timeoutId = setTimeout(invokeCallbackFn, time);\n\n  // returns a \"cancel\" function, so the execution of the callback can be prevented\n  return () => {\n    clearTimeout(timeoutId);\n    document.removeEventListener('visibilitychange', visHandler);\n  };\n};\n\n// Helper function to provide consistent formatting of template literals\n// that are logged when in development mode.\nUtil.debugMessage = function(message) {\n  Logger.warn(`\\n${message.replace(/^(\\s)+/gm, '')}`);\n};\n\nUtil.logConsoleError = function(message) {\n  Logger.error(message);\n};\n\n// Trigger an afterError event\nUtil.triggerAfterError = function(controller, err = {}) {\n  if (!err.statusCode && err.xhr && err.xhr.status) {\n    // Bring the statusCode to the top-level of the Error\n    err.statusCode = err.xhr.status;\n  }\n  // Some controllers return the className as a function - process it here:\n  const className = _.isFunction(controller.className) ? controller.className() : controller.className;\n\n  const error = _.pick(err, 'name', 'message', 'statusCode', 'xhr');\n\n  controller.trigger('afterError', { controller: className }, error);\n  // Logs to console only in dev mode\n  Logger.warn('controller: ' + className + ', error: ' + error);\n};\n\nUtil.redirect = function(url, win = window, isAppLink = false) {\n  if (BrowserFeatures.isAndroid() && !isAppLink) {\n    Util.redirectWithFormGet(url);\n  } else {\n    Util.changeLocation(url, win);\n  }\n};\n\nUtil.changeLocation = function(url, win = window) {\n  if (!url) {\n    Logger.error(`Cannot redirect to empty URL: (${url})`);\n    return;\n  }\n  win.location.href = url;\n};\n\nUtil.executeOnVisiblePage = function(cb) {\n  if (document.visibilityState === 'hidden') {\n    const visibilityChangeHandler = () => {\n      if (document.visibilityState === 'visible') {\n        document.removeEventListener('visibilitychange', visibilityChangeHandler);\n        cb();\n      }\n    };\n    document.addEventListener('visibilitychange', visibilityChangeHandler);\n  } else {\n    cb();\n  }\n};\n\n/**\n * Why redirect via Form get rather using `window.location.href`?\n * At the time of writing, Chrome (<72) in Android would block window location change\n * at following case\n * 1. An AJAX is trigger because of user action.\n * 2. 5+ seconds passed without any further user interaction.\n * 3. User takes an action results in window location change.\n *\n * Luckily we discovered that uses Form submit would work around this problem\n * even though it changed window location.\n *\n * Check the commit history for more details.\n */\nUtil.redirectWithFormGet = function(url) {\n  Util.redirectWithForm(url, 'get');\n};\n\n/**\n * Ensure the redirect form is only submitted once in case the method is\n * is invoked multiple times before the page navigation occurs.\n *\n * This singleton serves as a mutex to be used only by `Util.redirectWithForm`.\n */\n{\n  // Enclose the variable in a closure to prevent direct external access.\n  let redirectWithFormLock = false;\n\n  Util.getRedirectWithFormLock = function() {\n    return redirectWithFormLock;\n  };\n\n  // Intentionally do not provide a way to release the lock.\n  // There's no need to release the lock later because the page should\n  // be unloaded after the form is submitted.\n  Util.setRedirectWithFormLock = function() {\n    redirectWithFormLock = true;\n  };\n}\n\nUtil.redirectWithForm = function(url, method = 'post') {\n  if (!url) {\n    Logger.error(`Cannot redirect to empty URL: (${url})`);\n    return;\n  }\n\n  if (Util.getRedirectWithFormLock() === true) {\n    Logger.error('Cannot redirect with form, already in progress');\n    return;\n  }\n\n  const mainContainer = document.getElementById(Enums.WIDGET_CONTAINER_ID);\n\n  if (!mainContainer) {\n    Logger.error('Cannot find okta-sign-in container append to which a form');\n    return;\n  }\n\n  // Set the lock as we are now about to submit the form.\n  Util.setRedirectWithFormLock();\n\n  const form = buildDynamicForm(url, method);\n\n  mainContainer.appendChild(form);\n  form.querySelector('input[type=\"submit\"]').click();\n};\n\n/**\n * When we want to show an explain text, we need to check if this is different from\n * the label text, to not have an explain that look like a duplicated label.\n * okta-signin-widget gives the possibility to customize every i18n, so we cannot\n * know ahead if these two are equal or different, we need to call this function everytime.\n */\nUtil.createInputExplain = function(explainKey, labelKey, bundleName, explainParams, labelParams) {\n  const explain = explainParams ? loc(explainKey, bundleName, explainParams) : loc(explainKey, bundleName);\n  const label = labelParams ? loc(labelKey, bundleName, labelParams) : loc(labelKey, bundleName);\n\n  if (explain === label) {\n    return false;\n  }\n  return explain;\n};\n\nUtil.isV1StateToken = function(token) {\n  return !!(token && _.isString(token) && token.startsWith('00'));\n};\n\nUtil.getAutocompleteValue = function(settings, defaultValue) {\n  const shouldDisableAutocomplete = settings?.get('features.disableAutocomplete');\n  if (shouldDisableAutocomplete) {\n    return 'off';\n  }\n  return defaultValue;\n};\n\n/**\n * Equivalent of `new URLSearchParams(params).toString()` with broadest browser support.\n * Does not include params with nullish values.\n */\nUtil.searchParamsToString = function(params) {\n  return Object.keys(params)\n    .filter((key) => {\n      const val = params[key];\n      return val !== undefined && val !== null;\n    })\n    .map((key) => {\n      return encodeURIComponent(key) + '=' + encodeURIComponent(params[key]);\n    })\n    .join('&');\n};\n\nexport default Util;\n"],"names":["Util","buildInputForParameter","name","value","input","document","createElement","decodeURIComponent","type","buildSubmitInput","buildDynamicForm","url","method","splitOnFragment","split","fragment","splitOnQuery","query","targetUrl","form","style","display","action","length","queryParts","forEach","queryPart","parameterParts","appendChild","transformErrorXHR","xhr","status","_","isEmpty","responseJSON","errorSummary","loc","responseText","JSON","parse","e","errorCauses","errorCode","errorMsg","doesTranslationExist","undefined","indexOf","toLower","strings","map","str","toLowerCase","expandLanguage","language","expanded","parts","pop","push","join","expandLanguages","languages","chain","flatten","uniq","callAfterTimeout","callback","time","setTimeout","callAfterTimeoutOrWindowRefocus","delayAfterRefocus","timeoutId","visHandler","invokeCallbackFn","removeEventListener","hidden","clearTimeout","addEventListener","debugMessage","message","Logger","warn","replace","logConsoleError","error","triggerAfterError","controller","err","statusCode","className","isFunction","pick","trigger","redirect","win","window","isAppLink","BrowserFeatures","isAndroid","redirectWithFormGet","changeLocation","location","href","executeOnVisiblePage","cb","visibilityState","visibilityChangeHandler","redirectWithForm","redirectWithFormLock","getRedirectWithFormLock","setRedirectWithFormLock","mainContainer","getElementById","Enums","WIDGET_CONTAINER_ID","querySelector","click","createInputExplain","explainKey","labelKey","bundleName","explainParams","labelParams","explain","label","isV1StateToken","token","isString","startsWith","getAutocompleteValue","settings","defaultValue","shouldDisableAutocomplete","get","searchParamsToString","params","Object","keys","filter","key","val","encodeURIComponent"],"mappings":"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"}