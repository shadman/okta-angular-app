{"version":3,"file":"ManualSetupPushController.js","sources":["../../../../../src/v1/controllers/ManualSetupPushController.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _, loc, View } from '@okta/courage';\nimport hbs from '@okta/handlebars-inline-precompile';\nimport CountryUtil from 'util/CountryUtil';\nimport FactorUtil from 'util/FactorUtil';\nimport FormController from 'v1/util/FormController';\nimport FormType from 'v1/util/FormType';\nimport RouterUtil from 'v1/util/RouterUtil';\nimport Footer from 'v1/views/enroll-factors/ManualSetupPushFooter';\nimport PhoneTextBox from 'v1/views/enroll-factors/PhoneTextBox';\n\nfunction goToFactorActivation(view, step) {\n  const url = RouterUtil.createActivateFactorUrl(\n    view.options.appState.get('activatedFactorProvider'),\n    view.options.appState.get('activatedFactorType'),\n    step\n  );\n\n  view.options.appState.trigger('navigate', url);\n}\n\nconst sharedSecretIsDefined = {\n  sharedSecret: function(val) {\n    return !_.isUndefined(val);\n  },\n  activationType: 'MANUAL'\n};\n\nfunction setStateValues(view) {\n  let userPhoneNumber;\n  let userCountryCode;\n\n  if (view.model.get('activationType') === 'SMS') {\n    userCountryCode = view.model.get('countryCode');\n    userPhoneNumber = view.model.get('phoneNumber');\n  }\n  view.options.appState.set({\n    factorActivationType: view.model.get('activationType'),\n    userCountryCode: userCountryCode,\n    userPhoneNumber: userPhoneNumber,\n  });\n}\n\nfunction enrollFactor(view, factorType) {\n  return view.model.doTransaction(function(transaction) {\n    return transaction\n      .prev()\n      .then(function(trans) {\n        const factor = _.findWhere(trans.factors, {\n          factorType: factorType,\n          provider: 'OKTA',\n        });\n\n        return factor.enroll();\n      })\n      .then(function(trans) {\n        let textActivationLinkUrl;\n        let emailActivationLinkUrl;\n        let sharedSecret;\n        const res = trans.data;\n\n        if (\n          res &&\n          res._embedded &&\n          res._embedded.factor &&\n          res._embedded.factor._embedded &&\n          res._embedded.factor._embedded.activation\n        ) {\n          const factor = res._embedded.factor;\n\n          // Shared secret\n          sharedSecret = factor._embedded.activation.sharedSecret;\n\n          if (factor._embedded.activation._links && factor._embedded.activation._links.send) {\n            const activationSendLinks = factor._embedded.activation._links.send;\n\n            const smsItem = _.findWhere(activationSendLinks, { name: 'sms' });\n\n            // SMS activation url\n\n            textActivationLinkUrl = smsItem ? smsItem.href : null;\n\n            // Email activation url\n\n            const emailItem = _.findWhere(activationSendLinks, { name: 'email' });\n\n            emailActivationLinkUrl = emailItem ? emailItem.href : null;\n          }\n        }\n\n        view.model.set({\n          SMS: textActivationLinkUrl,\n          EMAIL: emailActivationLinkUrl,\n          sharedSecret: sharedSecret,\n        });\n\n        return trans;\n      });\n  });\n}\n\nexport default FormController.extend({\n  className: 'enroll-manual-push',\n  Model: function() {\n    return {\n      local: {\n        activationType: ['string', true, this.options.appState.get('factorActivationType') || 'SMS'],\n        countryCode: ['string', false, this.options.appState.get('userCountryCode')],\n        phoneNumber: 'string',\n        SMS: ['string', false, this.options.appState.get('textActivationLinkUrl')],\n        EMAIL: ['string', false, this.options.appState.get('emailActivationLinkUrl')],\n        sharedSecret: ['string', false, this.options.appState.get('sharedSecret')],\n        __factorType__: ['string', false, this.options.factorType],\n        __provider__: ['string', false, this.options.provider],\n      },\n      derived: {\n        countryCallingCode: {\n          deps: ['countryCode'],\n          fn: function(countryCode) {\n            return '+' + CountryUtil.getCallingCodeForCountry(countryCode);\n          },\n        },\n        fullPhoneNumber: {\n          deps: ['countryCallingCode', 'phoneNumber'],\n          fn: function(countryCallingCode, phoneNumber) {\n            return countryCallingCode + phoneNumber;\n          },\n        },\n      },\n    };\n  },\n\n  Form: {\n    title: function() {\n      const factorName = FactorUtil.getFactorLabel(this.model.get('__provider__'), this.model.get('__factorType__'));\n\n      return loc('enroll.totp.title', 'login', [factorName]);\n    },\n    subtitle: _.partial(loc, 'enroll.totp.cannotScanBarcode', 'login'),\n    noButtonBar: true,\n    attributes: { 'data-se': 'step-manual-setup' },\n\n    formChildren: function() {\n      const instructions = this.settings.get('brandName')\n        ? loc('enroll.totp.sharedSecretInstructions.specific', 'login', [this.settings.get('brandName')])\n        : loc('enroll.totp.sharedSecretInstructions.generic', 'login');\n      const children = [\n        FormType.Input({\n          name: 'activationType',\n          label:loc('mfa.setupOptions', 'login'),\n          type: 'select',\n          wide: true,\n          options: {\n            SMS: loc('enroll.totp.sendSms', 'login'),\n            EMAIL: loc('enroll.totp.sendEmail', 'login'),\n            MANUAL: loc('enroll.totp.setupManually', 'login'),\n          },\n        }),\n        FormType.Input({\n          label:loc('mfa.country', 'login'),\n          name: 'countryCode',\n          type: 'select',\n          wide: true,\n          options: CountryUtil.getCountries(),\n          showWhen: { activationType: 'SMS' },\n        }),\n        FormType.Input({\n          label: loc('mfa.phoneNumber.placeholder', 'login'),\n          'label-top': true,\n          className: 'enroll-sms-phone',\n          name: 'phoneNumber',\n          input: PhoneTextBox,\n          type: 'text',\n          showWhen: { activationType: 'SMS' },\n        }),\n        FormType.View({\n          View: View.extend({\n            className: 'secret-key-instructions',\n            attributes: { 'data-se': 'secret-key-instructions'},\n            template: hbs`\n             <section aria-live=\"assertive\">\n                <p  class=\"okta-form-subtitle o-form-explain text-align-c\">\n                  {{instructions}}\n                </p>\n                <p class=\"shared-key margin-top-10\" tabindex=0 \n                aria-label=\"{{i18n code=\"enroll.totp.sharedSecretInstructions.aria.secretKey\" bundle=\"login\"\n                arguments=\"sharedSecretKey\"}}\">{{sharedSecretKey}}</p>\n              </section>\n              `,\n            initialize: function(){\n              this.listenTo(this.model, 'change:sharedSecret', this.render);\n            },\n            getTemplateData: function() {\n              return {\n                instructions: instructions,\n                sharedSecretKey: this.model.get('sharedSecret')\n              };\n            },\n          }),\n          showWhen: { activationType: 'MANUAL' },\n        }),\n        FormType.View({\n          View: View.extend({\n            template: hbs('<div data-type=\"next-button-wrap\"></div>'),\n          }),\n          showWhen: sharedSecretIsDefined,\n        }),\n        FormType.Button(\n          {\n            title: loc('oform.next', 'login'),\n            className: 'button button-primary button-wide button-next',\n            attributes: { 'data-se': 'next-button' },\n            click: () => {\n              setStateValues(this);\n              goToFactorActivation(this, 'passcode');\n            },\n          },\n          '[data-type=\"next-button-wrap\"]'\n        ),\n        FormType.Toolbar({\n          noCancelButton: true,\n          save: loc('oform.send', 'login'),\n          showWhen: {\n            activationType: function(val) {\n              return val === 'SMS' || val === 'EMAIL';\n            },\n          },\n        }),\n      ];\n\n      return children;\n    },\n  },\n\n  Footer: Footer,\n\n  initialize: function() {\n    this.setInitialModel();\n    // Move this logic to a model when AuthClient supports sending email and sms\n    this.listenTo(this.form, 'save', function() {\n      const self = this;\n\n      this.model.doTransaction(function(transaction) {\n        const activationType = this.get('activationType').toLowerCase();\n        const opts = {};\n\n        if (activationType === 'sms') {\n          opts.profile = { phoneNumber: this.get('fullPhoneNumber') };\n        }\n\n        return transaction.factor.activation.send(activationType, opts).then(function(trans) {\n          setStateValues(self);\n          // Note: Need to defer because OktaAuth calls our router success\n          // handler on the next tick - if we immediately called, appState would\n          // still be populated with the last response\n          _.defer(function() {\n            goToFactorActivation(self, 'sent');\n          });\n          return trans;\n        });\n      });\n    });\n\n    this.listenTo(this.model, 'change:activationType', function(model, value) {\n      this.form.clearErrors();\n      if (value === 'MANUAL' && this.options.appState.get('activatedFactorType') !== 'token:software:totp') {\n        enrollFactor(this, 'token:software:totp');\n      } else if (this.options.appState.get('activatedFactorType') !== 'push') {\n        enrollFactor(this, 'push');\n      }\n    });\n  },\n\n  setInitialModel: function() {\n    if (this.options.appState.get('factorActivationType') === 'SMS') {\n      this.model.set({\n        countryCode: this.options.appState.get('userCountryCode') || 'US',\n        phoneNumber: this.options.appState.get('userPhoneNumber'),\n      });\n    }\n  },\n\n  trapAuthResponse: function() {\n    if (this.options.appState.get('isMfaEnrollActivate') || this.options.appState.get('isMfaEnroll')) {\n      return true;\n    }\n  },\n});\n"],"names":["goToFactorActivation","view","step","url","RouterUtil","createActivateFactorUrl","options","appState","get","trigger","sharedSecretIsDefined","sharedSecret","val","_","isUndefined","activationType","setStateValues","userPhoneNumber","userCountryCode","model","set","factorActivationType","enrollFactor","factorType","doTransaction","transaction","prev","then","trans","factor","findWhere","factors","provider","enroll","textActivationLinkUrl","emailActivationLinkUrl","res","data","_embedded","activation","_links","send","activationSendLinks","smsItem","name","href","emailItem","SMS","EMAIL","FormController","extend","className","Model","local","countryCode","phoneNumber","__factorType__","__provider__","derived","countryCallingCode","deps","fn","CountryUtil","getCallingCodeForCountry","fullPhoneNumber","Form","title","factorName","FactorUtil","getFactorLabel","loc","subtitle","partial","noButtonBar","attributes","formChildren","instructions","settings","children","FormType","Input","label","type","wide","MANUAL","getCountries","showWhen","input","PhoneTextBox","View","template","initialize","listenTo","render","getTemplateData","sharedSecretKey","Button","click","Toolbar","noCancelButton","save","Footer","setInitialModel","form","self","toLowerCase","opts","profile","defer","value","clearErrors","trapAuthResponse"],"mappings":"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"}